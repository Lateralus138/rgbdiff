name: Working Workflow

on:
  push:
    branches:
      - 'working'

jobs:
  test:
    runs-on: windows-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 2
      - name: Working Test For Source File Changes
        shell: pwsh
        id: working_test_for_source_file_changes
        run: |
          $files = git diff --name-only HEAD^ HEAD | Where-Object { $_ -match '^.*\.(cpp|h|yml|ps1|sh)$' }
          $source_files_changed = $files.Length -gt 0
          Write-Output "source_files_changed=$source_files_changed" >> $Env:GITHUB_OUTPUT
          Write-Output "source_files=$files" >> $Env:GITHUB_OUTPUT
      - name: Source Files Changed
        shell: pwsh
        if: steps.working_test_for_source_file_changes.outputs.source_files_changed == 'True'
        run: |
          $files = "${{ steps.working_test_for_source_file_changes.outputs.source_files }}".Split(' ')
          $script = { $files | Where-Object { $_ -match '^.*buildwindows\.ps1$'} | Foreach-Object { $_ } }
          &$script
          "Done."